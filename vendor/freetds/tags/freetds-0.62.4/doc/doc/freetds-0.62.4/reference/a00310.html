<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Results processing</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>Results processing<br>
<small>
[<a class="el" href="a00311.html">LibTDS API</a>]</small>
</h1>Handle tokens in packets. 
<a href="#_details">More...</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="a00310.html#a2">tds_process_login_tokens</a> (TDSSOCKET *tds)</td></tr>
<tr><td>&nbsp;</td><td><em class="mdesc"><a class="el" href="a00310.html#a2">tds_process_login_tokens()</a> is called after sending the login packet to the server.</em> <a href="#a2"></a><em></em><br><br></td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="a00310.html#a4">tds_process_result_tokens</a> (TDSSOCKET *tds, TDS_INT *result_type, int *done_flags)</td></tr>
<tr><td>&nbsp;</td><td><em class="mdesc">process TDS result-type message streams.</em> <a href="#a4"></a><em></em><br><br></td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="a00310.html#a5">tds_process_row_tokens</a> (TDSSOCKET *tds, TDS_INT *rowtype, TDS_INT *computeid)</td></tr>
<tr><td>&nbsp;</td><td><em class="mdesc">process TDS row-type message streams.</em> <a href="#a5"></a><em></em><br><br></td></tr>
<tr><td nowrap align=right valign=top><a name="a6" doxytag="token::tds_process_row_tokens_ct"></a>
int&nbsp;</td><td valign=bottom><b>tds_process_row_tokens_ct</b> (TDSSOCKET *tds, TDS_INT *rowtype, TDS_INT *computeid)</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="a00310.html#a8">tds_process_trailing_tokens</a> (TDSSOCKET *tds)</td></tr>
<tr><td>&nbsp;</td><td><em class="mdesc"><a class="el" href="a00310.html#a8">tds_process_trailing_tokens()</a> is called to discard messages that may be left unprocessed at the end of a result "batch".</em> <a href="#a8"></a><em></em><br><br></td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="a00310.html#a9">tds_process_simple_query</a> (TDSSOCKET *tds)</td></tr>
<tr><td>&nbsp;</td><td><em class="mdesc">Process results for simple query as "SET TEXTSIZE" or "USE dbname" If the statement returns results, beware they are discarded.</em> <a href="#a9"></a><em></em><br><br></td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="a00310.html#a10">tds_do_until_done</a> (TDSSOCKET *tds)</td></tr>
<tr><td>&nbsp;</td><td><em class="mdesc">simple flush function.</em> <a href="#a10"></a><em></em><br><br></td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="a00310.html#a12">tds_add_row_column_size</a> (<a class="el" href="a00181.html">TDSRESULTINFO</a> *info, <a class="el" href="a00168.html">TDSCOLINFO</a> *curcol)</td></tr>
<tr><td>&nbsp;</td><td><em class="mdesc">Add a column size to result info row size and calc offset into row.</em> <a href="#a12"></a><em></em><br><br></td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="a00310.html#a28">tds_client_msg</a> (TDSCONTEXT *tds_ctx, TDSSOCKET *tds, int msgnum, int level, int state, int line, const char *message)</td></tr>
<tr><td>&nbsp;</td><td><em class="mdesc"><a class="el" href="a00310.html#a28">tds_client_msg()</a> sends a message to the client application from the CLI or TDS layer.</em> <a href="#a28"></a><em></em><br><br></td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="a00310.html#a31">tds_alloc_get_string</a> (TDSSOCKET *tds, char **string, int len)</td></tr>
<tr><td>&nbsp;</td><td><em class="mdesc">Read a string from wire in a new allocated buffer.</em> <a href="#a31"></a><em></em><br><br></td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="a00310.html#a32">tds_process_cancel</a> (TDSSOCKET *tds)</td></tr>
<tr><td>&nbsp;</td><td><em class="mdesc"><a class="el" href="a00310.html#a32">tds_process_cancel()</a> processes the incoming token stream until it finds an end token (DONE, DONEPROC, DONEINPROC) with the cancel flag set.</em> <a href="#a32"></a><em></em><br><br></td></tr>
<tr><td nowrap align=right valign=top><a name="a33" doxytag="token::tds_set_null"></a>
void&nbsp;</td><td valign=bottom><a class="el" href="a00310.html#a33">tds_set_null</a> (unsigned char *current_row, int column)</td></tr>
<tr><td>&nbsp;</td><td><em class="mdesc">set the null bit for the given column in the row buffer</em><br><br></td></tr>
<tr><td nowrap align=right valign=top><a name="a34" doxytag="token::tds_clr_null"></a>
void&nbsp;</td><td valign=bottom><a class="el" href="a00310.html#a34">tds_clr_null</a> (unsigned char *current_row, int column)</td></tr>
<tr><td>&nbsp;</td><td><em class="mdesc">clear the null bit for the given column in the row buffer</em><br><br></td></tr>
<tr><td nowrap align=right valign=top><a name="a35" doxytag="token::tds_get_null"></a>
int&nbsp;</td><td valign=bottom><a class="el" href="a00310.html#a35">tds_get_null</a> (unsigned char *current_row, int column)</td></tr>
<tr><td>&nbsp;</td><td><em class="mdesc">Return the null bit for the given column in the row buffer.</em><br><br></td></tr>
<tr><td nowrap align=right valign=top>TDSDYNAMIC *&nbsp;</td><td valign=bottom><a class="el" href="a00310.html#a36">tds_lookup_dynamic</a> (TDSSOCKET *tds, char *id)</td></tr>
<tr><td>&nbsp;</td><td><em class="mdesc">Find a dynamic given string id.</em> <a href="#a36"></a><em></em><br><br></td></tr>
<tr><td nowrap align=right valign=top><a name="a40" doxytag="token::tds_get_token_size"></a>
int&nbsp;</td><td valign=bottom><a class="el" href="a00310.html#a40">tds_get_token_size</a> (int marker)</td></tr>
<tr><td>&nbsp;</td><td><em class="mdesc"><a class="el" href="a00310.html#a40">tds_get_token_size()</a> returns the size of a fixed length token used by <a class="el" href="a00310.html#a32">tds_process_cancel()</a> to determine how to read past a token</em><br><br></td></tr>
<tr><td nowrap align=right valign=top><a name="a41" doxytag="token::tds_swap_datatype"></a>
void&nbsp;</td><td valign=bottom><b>tds_swap_datatype</b> (int coltype, unsigned char *buf)</td></tr>
<tr><td nowrap align=right valign=top><a name="a46" doxytag="token::tds5_send_optioncmd"></a>
int&nbsp;</td><td valign=bottom><b>tds5_send_optioncmd</b> (TDSSOCKET *tds, <a class="el" href="a00273.html#a570">TDS_OPTION_CMD</a> tds_command, TDS_OPTION tds_option, TDS_OPTION_ARG *ptds_argument, TDS_INT *ptds_argsize)</td></tr>
<tr><td nowrap align=right valign=top><a name="a48" doxytag="token::tds_prtype"></a>
const char *&nbsp;</td><td valign=bottom><b>tds_prtype</b> (int token)</td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Handle tokens in packets.
<p>
Many PDU (packets data unit) contain tokens. (like result description, rows, data, errors and many other). <hr><h2>Function Documentation</h2>
<a name="a12" doxytag="token.c::tds_add_row_column_size"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void tds_add_row_column_size </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="a00181.html">TDSRESULTINFO</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>info</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="a00168.html">TDSCOLINFO</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>curcol</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Add a column size to result info row size and calc offset into row.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>info</em>&nbsp;</td><td>result where to add column </td></tr>
    <tr><td valign=top><em>curcol</em>&nbsp;</td><td>column to add </td></tr>
  </table>
</dl>
    </td>
  </tr>
</table>
<a name="a31" doxytag="token.c::tds_alloc_get_string"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int tds_alloc_get_string </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">TDSSOCKET *&nbsp;</td>
          <td class="mdname" nowrap> <em>tds</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>char **&nbsp;</td>
          <td class="mdname" nowrap> <em>string</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>len</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Read a string from wire in a new allocated buffer.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>len</em>&nbsp;</td><td>length of string to read </td></tr>
  </table>
</dl>
    </td>
  </tr>
</table>
<a name="a28" doxytag="token.c::tds_client_msg"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int tds_client_msg </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">TDSCONTEXT *&nbsp;</td>
          <td class="mdname" nowrap> <em>tds_ctx</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>TDSSOCKET *&nbsp;</td>
          <td class="mdname" nowrap> <em>tds</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>msgnum</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>level</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>state</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>line</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>message</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<a class="el" href="a00310.html#a28">tds_client_msg()</a> sends a message to the client application from the CLI or TDS layer.
<p>
A client message is one that is generated from with the library and not from the server. The message is sent to the CLI (the err_handler) so that it may forward it to the client application or discard it if no msg handler has been by the application. tds-&gt;parent contains a void pointer to the parent of the tds socket. This can be cast back into DBPROCESS or CS_CONNECTION by the CLI and used to determine the proper recipient function for this message. <p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000047">Todo:</a></b></dt><dd>This procedure is deprecated, because the client libraries use differing messages and message numbers. The general approach is to emit ct-lib error information and let db-lib and ODBC map that to their number and text. </dd></dl>
    </td>
  </tr>
</table>
<a name="a10" doxytag="bcp.c::tds_do_until_done"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int tds_do_until_done </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">TDSSOCKET *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>tds</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
simple flush function.
<p>
maybe be superseded soon.     </td>
  </tr>
</table>
<a name="a36" doxytag="token.c::tds_lookup_dynamic"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> TDSDYNAMIC* tds_lookup_dynamic </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">TDSSOCKET *&nbsp;</td>
          <td class="mdname" nowrap> <em>tds</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>id</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Find a dynamic given string id.
<p>
<dl compact><dt><b>Returns:</b></dt><dd>dynamic or NULL is not found </dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>id</em>&nbsp;</td><td>dynamic id to search </td></tr>
  </table>
</dl>
    </td>
  </tr>
</table>
<a name="a32" doxytag="token.c::tds_process_cancel"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int tds_process_cancel </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">TDSSOCKET *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>tds</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<a class="el" href="a00310.html#a32">tds_process_cancel()</a> processes the incoming token stream until it finds an end token (DONE, DONEPROC, DONEINPROC) with the cancel flag set.
<p>
a that point the connetion should be ready to handle a new query.     </td>
  </tr>
</table>
<a name="a2" doxytag="token.c::tds_process_login_tokens"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int tds_process_login_tokens </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">TDSSOCKET *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>tds</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<a class="el" href="a00310.html#a2">tds_process_login_tokens()</a> is called after sending the login packet to the server.
<p>
It returns the success or failure of the login dependent on the protocol version. 4.2 sends an ACK token only when successful, TDS 5.0 sends it always with a success byte within     </td>
  </tr>
</table>
<a name="a4" doxytag="token.c::tds_process_result_tokens"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int tds_process_result_tokens </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">TDSSOCKET *&nbsp;</td>
          <td class="mdname" nowrap> <em>tds</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>TDS_INT *&nbsp;</td>
          <td class="mdname" nowrap> <em>result_type</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int *&nbsp;</td>
          <td class="mdname" nowrap> <em>done_flags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
process TDS result-type message streams.
<p>
<a class="el" href="a00310.html#a4">tds_process_result_tokens()</a> is called after submitting a query with <a class="el" href="a00307.html#a3">tds_submit_query()</a> and is responsible for calling the routines to populate tds-&gt;res_info if appropriate (some query have no result sets) <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>tds</em>&nbsp;</td><td>A pointer to the TDSSOCKET structure managing a client/server operation. </td></tr>
    <tr><td valign=top><em>result_type</em>&nbsp;</td><td>A pointer to an integer variable which tds_process_result_tokens sets to indicate the current type of result. </td></tr>
  </table>
</dl>
<dl compact><dt><b></b></dt><dd><b>Values that indicate command status</b> <table border="1" cellspacing="3" cellpadding="3">
<tr>
<td>TDS_DONE_RESULT</td><td>The results of a command have been completely processed. This command return no rows. </td></tr>
<tr>
<td>TDS_DONEPROC_RESULT</td><td>The results of a command have been completely processed. This command return rows. </td></tr>
<tr>
<td>TDS_DONEINPROC_RESULT</td><td>The results of a command have been completely processed. This command return rows. </td></tr>
</table>
<b>Values that indicate results information is available</b> <table border="1" cellspacing="3" cellpadding="3">
<tr>
<td>TDS_ROWFMT_RESULT</td><td>Regular Data format information </td><td>tds-&gt;res_info now contains the result details ; tds-&gt;curr_resinfo now points to that data </td></tr>
<tr>
<td>TDS_COMPUTEFMT_ RESULT</td><td>Compute data format information </td><td>tds-&gt;comp_info now contains the result data; tds-&gt;curr_resinfo now points to that data </td></tr>
<tr>
<td>TDS_DESCRIBE_RESULT</td><td></td><td></td></tr>
</table>
<b>Values that indicate data is available</b> <table border="1" cellspacing="3" cellpadding="3">
<tr>
<td><b>Value</b></td><td><b>Meaning</b></td><td><b>Information returned</b> </td></tr>
<tr>
<td>TDS_ROW_RESULT</td><td>Regular row results </td><td>1 or more rows of regular data can now be retrieved </td></tr>
<tr>
<td>TDS_COMPUTE_RESULT</td><td>Compute row results </td><td>A single row of compute data can now be retrieved </td></tr>
<tr>
<td>TDS_PARAM_RESULT</td><td>Return parameter results </td><td>param_info or cur_dyn-&gt;params contain returned parameters </td></tr>
<tr>
<td>TDS_STATUS_RESULT</td><td>Stored procedure status results </td><td>tds-&gt;ret_status contain the returned code </td></tr>
</table>
</dd></dl>
<dl compact><dt><b><a class="el" href="todo.html#_todo000046">Todo:</a></b></dt><dd>Complete TDS_DESCRIBE_RESULT description</dd></dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>TDS_SUCCEED</em>&nbsp;</td><td>if a result set is available for processing. </td></tr>
    <tr><td valign=top><em>TDS_NO_MORE_RESULTS</em>&nbsp;</td><td>if all results have been completely processed. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Examples</b></dt><dd>The following code is cut from <a class="el" href="a00220.html#a14">ct_results()</a>, the ct-library function <div class="fragment"><pre>done = 0;

    <span class="comment">/* see what "result" tokens we have. a "result" in ct-lib terms also  */</span>
    <span class="comment">/* includes row data. Some result types always get reported back  to  */</span>
    <span class="comment">/* the calling program, others are only reported back if the relevant */</span>
    <span class="comment">/* config flag is set.                                                */</span>

<span class="keywordflow">while</span> (!done) {

        tdsret = <a class="code" href="a00310.html#a4">tds_process_result_tokens</a>(tds, &amp;res_type, NULL);

        <span class="keywordflow">switch</span> (tdsret) {

        <span class="keywordflow">case</span> TDS_SUCCEED:

                cmd-&gt;curr_result_type = res_type;

                <span class="keywordflow">switch</span> (res_type) {
                <span class="keywordflow">case</span> TDS_COMPUTEFMT_RESULT:
                <span class="keywordflow">case</span> TDS_ROWFMT_RESULT:
                        <span class="keywordflow">if</span> (context-&gt;config.cs_expose_formats) {
                                done = 1;
                                retcode = CS_SUCCEED;
                                *result_type = res_type;
                        }
                        <span class="keywordflow">break</span>;

                <span class="keywordflow">case</span> TDS_COMPUTE_RESULT:
                        <span class="comment">/* we've hit a compute data row. We have to get hold of this */</span>
                        <span class="comment">/* data now, as it's necessary  to tie this data back to its */</span>
                        <span class="comment">/* result format...the user may call ct_res_info() &amp; friends */</span>
                        <span class="comment">/* after getting back a compute "result".                    */</span>

                        tdsret = <a class="code" href="a00310.html#a5">tds_process_row_tokens</a>(tds, &amp;rowtype, &amp;computeid);

                        <span class="keywordflow">if</span> (tdsret == TDS_SUCCEED) {
                                <span class="keywordflow">if</span> (rowtype == TDS_COMP_ROW) {
                                        cmd-&gt;row_prefetched = 1;
                                        retcode = CS_SUCCEED;
                                } <span class="keywordflow">else</span> {
                                        <span class="comment">/* this couldn't really happen, but... */</span>
                                        retcode = CS_FAIL;
                                }
                        } <span class="keywordflow">else</span>
                                retcode = CS_FAIL;
                        done = 1;
                        *result_type = res_type;
                        <span class="keywordflow">break</span>;

                <span class="keywordflow">case</span> TDS_DONE_RESULT:
                <span class="keywordflow">case</span> TDS_DONEPROC_RESULT:
                <span class="keywordflow">case</span> TDS_DONEINPROC_RESULT:

                        <span class="comment">/* there's a distinction in ct-library     */</span>
                        <span class="comment">/* depending on whether a command returned */</span>
                        <span class="comment">/* results or not...                          */</span>

                        <span class="keywordflow">if</span> (tds-&gt;res_info)
                                *result_type = CS_CMD_DONE;
                        <span class="keywordflow">else</span>
                                *result_type = CS_CMD_SUCCEED;

                        retcode = CS_SUCCEED;
                        done = 1;
                        <span class="keywordflow">break</span>;


                <span class="keywordflow">default</span>:
                        retcode = CS_SUCCEED;
                        *result_type = res_type;
                        done = 1;
                        <span class="keywordflow">break</span>;
                }
                <span class="keywordflow">break</span>;

        <span class="keywordflow">case</span> TDS_NO_MORE_RESULTS:
                done = 1;
                retcode = CS_END_RESULTS;
                <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> TDS_FAIL:
                done = 1;
                retcode = CS_FAIL;
                <span class="keywordflow">break</span>;
        }
}
</pre></div> </dd></dl>
    </td>
  </tr>
</table>
<a name="a5" doxytag="token.c::tds_process_row_tokens"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int tds_process_row_tokens </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">TDSSOCKET *&nbsp;</td>
          <td class="mdname" nowrap> <em>tds</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>TDS_INT *&nbsp;</td>
          <td class="mdname" nowrap> <em>rowtype</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>TDS_INT *&nbsp;</td>
          <td class="mdname" nowrap> <em>computeid</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
process TDS row-type message streams.
<p>
<a class="el" href="a00310.html#a5">tds_process_row_tokens()</a> is called once a result set has been obtained with <a class="el" href="a00310.html#a4">tds_process_result_tokens()</a>. It calls <a class="el" href="a00310.html#a26">tds_process_row()</a> to copy data into the row buffer. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>tds</em>&nbsp;</td><td>A pointer to the TDSSOCKET structure managing a client/server operation. </td></tr>
    <tr><td valign=top><em>rowtype</em>&nbsp;</td><td>A pointer to an integer variable which tds_process_row_tokens sets to indicate the current type of row </td></tr>
    <tr><td valign=top><em>computeid</em>&nbsp;</td><td>A pointer to an integer variable which tds_process_row_tokens sets to identify the compute_id of the row being returned. A compute row is a row that is generated by a compute clause. The compute_id matches the number of the compute row that was read; the first compute row is 1, the second is 2, and so forth. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Possible values of *rowtype</b></dt><dd><ul>
<li><code>TDS_REG_ROW</code> A regular data row </li>
<li><code>TDS_COMP_ROW</code> A row of compute data </li>
<li><code>TDS_NO_MORE_ROWS</code> There are no more rows of data in this result set </li>
</ul>
</dd></dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>TDS_SUCCEED</em>&nbsp;</td><td>A row of data is available for processing. </td></tr>
    <tr><td valign=top><em>TDS_NO_MORE_ROWS</em>&nbsp;</td><td>All rows have been completely processed. </td></tr>
    <tr><td valign=top><em>TDS_FAIL</em>&nbsp;</td><td>An unexpected error occurred </td></tr>
  </table>
</dl>
<dl compact><dt><b>Examples</b></dt><dd>The following code is cut from <a class="el" href="a00297.html#a13">dbnextrow()</a>, the db-library function <div class="fragment"><pre><span class="keywordflow">if</span> ((ret = <a class="code" href="a00310.html#a5">tds_process_row_tokens</a>(dbproc-&gt;tds_socket, &amp;rowtype, &amp;computeid))
    == TDS_SUCCEED) {
        <span class="keywordflow">if</span> (rowtype == TDS_REG_ROW) {
                <span class="comment">/* Add the row to the row buffer */</span>
                resinfo = tds-&gt;curr_resinfo;
                buffer_add_row(&amp;(dbproc-&gt;row_buf), resinfo-&gt;current_row,
                                        resinfo-&gt;row_size);
                result = REG_ROW;
        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rowtype == TDS_COMP_ROW) {
                <span class="comment">/* Add the row to the row buffer */</span>
                resinfo = tds-&gt;curr_resinfo;
                buffer_add_row(&amp;(dbproc-&gt;row_buf), resinfo-&gt;current_row,
                                        resinfo-&gt;row_size);
                result = computeid;
        } <span class="keywordflow">else</span>
                result = FAIL;
} <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ret == TDS_NO_MORE_ROWS) {
        result = NO_MORE_ROWS;
} <span class="keywordflow">else</span>
        result = FAIL;
</pre></div> </dd></dl>
    </td>
  </tr>
</table>
<a name="a9" doxytag="token.c::tds_process_simple_query"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int tds_process_simple_query </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">TDSSOCKET *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>tds</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Process results for simple query as "SET TEXTSIZE" or "USE dbname" If the statement returns results, beware they are discarded.
<p>
This function was written to avoid direct calls to tds_process_default_tokens (which caused problems such as ignoring query errors). Results are read until idle state or severe failure (do not stop for statement failure). <dl compact><dt><b>Returns:</b></dt><dd>see tds_process_result_tokens for results (TDS_NO_MORE_RESULTS is never returned) </dd></dl>
    </td>
  </tr>
</table>
<a name="a8" doxytag="token.c::tds_process_trailing_tokens"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int tds_process_trailing_tokens </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">TDSSOCKET *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>tds</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<a class="el" href="a00310.html#a8">tds_process_trailing_tokens()</a> is called to discard messages that may be left unprocessed at the end of a result "batch".
<p>
In dblibrary, it is valid to process all the data rows that a command may have returned but to leave end tokens etc. unprocessed (at least explicitly) This function is called to discard such tokens. If it comes across a token that does not fall into the category of valid "trailing" tokens, it will return TDS_FAIL, allowing the calling dblibrary function to return a "results pending" message. The valid "trailing" tokens are :<p>
TDS_DONE_TOKEN TDS_DONEPROC_TOKEN TDS_DONEINPROC_TOKEN TDS_RETURNSTATUS_TOKEN TDS_PARAM_TOKEN TDS5_PARAMFMT_TOKEN TDS5_PARAMS_TOKEN     </td>
  </tr>
</table>
<hr><address style="align: right;"><small>Generated on Sun Jun 13 18:55:28 2004 for FreeTDS API by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3 </small></address>
</body>
</html>
