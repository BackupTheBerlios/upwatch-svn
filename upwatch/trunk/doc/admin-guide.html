<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Upwatch Administration Guide</title><meta name="generator" content="DocBook XSL Stylesheets V1.58.1"><style type="text/css">
body { background-image: url('http://docbook.sourceforge.net/release/images/draft.png');
       background-repeat: no-repeat;
       background-position: top left;
       /* The following properties make the watermark "fixed" on the page. */
       /* I think that's just a bit too distracting for the reader... */
       /* background-attachment: fixed; */
       /* background-position: center center; */
</style></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="book" lang="en"><div class="titlepage"><div><h1 class="title"><a name="upwatch"></a>Upwatch Administration Guide</h1></div><div><div class="author"><h3 class="author">Ron Arts</h3></div></div><div><p class="copyright">Copyright © 2002-2004 UpWatch BV, The Netherlands</p></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><a href="#id5428290">Preface</a></dt><dt>1. <a href="#About_UpWatch">About UpWatch</a></dt><dd><dl><dt>1.1. <a href="#Upwatch_History">History</a></dt><dt>1.2. <a href="#Upwatch_features">Features</a></dt></dl></dd><dt>2. <a href="#id5365874">Installation</a></dt><dd><dl><dt>2.1. <a href="#Getting_upwatch">Getting upwatch</a></dt><dt>2.2. <a href="#Requirements">Requirements</a></dt><dd><dl><dt>2.2.1. <a href="#Run-time_requirements">Run-time requirements</a></dt><dt>2.2.2. <a href="#Build_requirements">Build requirements</a></dt></dl></dd><dt>2.3. <a href="#Compiling_upwatch">Compiling upwatch</a></dt><dt>2.4. <a href="#Actual_Installation">Actual Installation</a></dt><dt>2.5. <a href="#php_pages">PHP pages</a></dt><dt>2.6. <a href="#Security_considerations">Security considerations</a></dt><dt>2.7. <a href="#Database">Database</a></dt></dl></dd><dt>3. <a href="#Configuration">Configuration</a></dt><dd><dl><dt>3.1. <a href="#Probe_configuration">Probe configuration</a></dt><dt>3.2. <a href="#Database_configuration">Database configuration</a></dt></dl></dd><dt>4. <a href="#Administration">Administration</a></dt><dd><dl><dt>4.1. <a href="#logging">Logging</a></dt><dt>4.2. <a href="#managing_daemons">Managing daemons</a></dt><dt>4.3. <a href="#Queues">Queues</a></dt></dl></dd><dt><a href="#id5366320">Index</a></dt></dl></div><div class="preface" lang="en"><div class="titlepage"><div><h2 class="title"><a name="id5428290"></a>Preface</h2></div></div><p> People, especially managers, like to have facts and figures when taking decisions,
            either because a lot of money may be involved, or their job (or both). If you want to
            prove your website (or switch, or basically any other device) was available, showed the
            proper performance, or just want to know current and past CPU load, you've come to the
            right place.</p></div><div class="chapter" lang="en"><div class="titlepage"><div><h2 class="title"><a name="About_UpWatch"></a>Chapter 1. About UpWatch</h2></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt>1.1. <a href="#Upwatch_History">History</a></dt><dt>1.2. <a href="#Upwatch_features">Features</a></dt></dl></div><div class="sect1" lang="en"><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="Upwatch_History"></a>1.1. History</h2></div></div><p>UpWatch is born from the loins of Netland Internet Services BV, Amsterdam, 
    The Netherlands. We are a hosting company which started in 1993 (when even Bill Gates knew
    nothing of the internet). We started doing managed hosting in 1995, and that's when
    we found out about monitoring. The hard way.</p><p>It became clear that customers can easily bring down their own server on impossible
    moments, and that it doesn't look very good if you both find out about that the monday 
    after. So we started doing SLA's and limit customer rights on their own server.</p><p>Initially we used Big Brother (bb4.com) for monitoring. This is an outstanding
    and useful package, and we have been using it for many years. But it has a few downsides.
    One is scalability. It does not scale well to hundreds of hosts. Also it has a
    geek-like look, we felt we couldn't give the URL to our customers. Third problem
    was integration with our backoffice.</p><p>At the same time yours truly was thinking about setting up a commercial
    service for monitoring servers remotely. All this culminated into UpWatch. So lets get 
    straight to the ..</p></div><div class="sect1" lang="en"><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="Upwatch_features"></a>1.2. Features</h2></div></div><p>This is the full list of upwatch features:</p><div class="itemizedlist"><ul type="disc"><li><p>Scalable: designed for monitoring tens of thousands of hosts</p></li><li><p>Resilient: autorestarts after database failures, forgiving for operator errors</p></li><li><p>SuSE, RedHat and Fedora RPM's generated from sourcetree for easy installation</p></li><li><p>Extensive and complete documentation, partly generated from source</p></li><li><p>Multi-tenanting: multiple companies can run monitoring services for network
    of multiple client-companies using the same backend+probe serverpark</p></li><li><p>OS support: clients available for Linux, Windows, FreeBSD, Solaris, server runs on
    linux or freeBSD, remote monitoring is linux only.</p></li><li><p>Monitoring results are in XML, and can be pre- and postprocessed</p></li><li><p>Secure: run as ordinary user, developed with security in mind</p></li><li><p>Compatible with all Big Brother clients, imports bb-hosts file</p></li><li><p>GUI is multi-language enabled (uses gettext)</p></li><li><p>GUI has mobile client support</p></li><li><p>Generates realtime graphs from the database</p></li><li><p>Notifications by email or SMS.</p></li><li><p>Clients for: HTTP GET, IMAP, MSSQL, MySQL, PING, POP3, PostgreSQL, SMTP, 
    SNMP GET, TCP connect (any port)</p></li><li><p>Local client detects: CPU load, loadavg, swap use, I/O use, memory use, and
    where supported hardware info like CPU temperature, fan speed and Power voltages. Also you can
    set it up to scan any logfile using regular expressions you supply.</p></li><li><p>Fully opensource: GUI built on Apache/PHP, Backend on C/Perl, 
    Database is MySQL. Uses GNU configure.</p></li></ul></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><h2 class="title"><a name="id5365874"></a>Chapter 2. Installation</h2></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt>2.1. <a href="#Getting_upwatch">Getting upwatch</a></dt><dt>2.2. <a href="#Requirements">Requirements</a></dt><dd><dl><dt>2.2.1. <a href="#Run-time_requirements">Run-time requirements</a></dt><dt>2.2.2. <a href="#Build_requirements">Build requirements</a></dt></dl></dd><dt>2.3. <a href="#Compiling_upwatch">Compiling upwatch</a></dt><dt>2.4. <a href="#Actual_Installation">Actual Installation</a></dt><dt>2.5. <a href="#php_pages">PHP pages</a></dt><dt>2.6. <a href="#Security_considerations">Security considerations</a></dt><dt>2.7. <a href="#Database">Database</a></dt></dl></div><div class="sect1" lang="en"><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="Getting_upwatch"></a>2.1. Getting upwatch</h2></div></div><p> Currently, upwatch is not released, and is not allowed to be distributed. The
          only way to get it, is through written permission of UpWatch BV.</p><p> If you aquired that, you will either receive access to CVS, or will receive a
            tar.gz file, or .RPM's.</p><p>Building and installing upwatch is not for the faint of heart. It uses lots of external
          libraries which may or may not be available on your platform. I myself use Redhat 8/9
          for development, and test compilation on RH7, Fedora Core 1/2, SuSE8.2, Solaris, 
          FreeBSD, and Yellowdog Linux 3.0.
       </p></div><div class="sect1" lang="en"><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="Requirements"></a>2.2. Requirements</h2></div></div><div class="sect2" lang="en"><div class="titlepage"><div><h3 class="title"><a name="Run-time_requirements"></a>2.2.1. Run-time requirements</h3></div></div><p>First ensure that the time/date on all hosts is correctly set. </p><p>Run time requirements differ per probe. Look in the corresponding .def file
                (or in the spec file for the probe), here's a list of everything we expect on a
                machine running all probes, and the database (I'll also list the version we use ourselves):</p><div class="itemizedlist"><ul type="disc"><li><p>glib2 &gt;= 2.0.4</p></li><li><p>xml2 (any version will do)</p></li><li><p>freetds &gt;= 0.6.0 compiled with --enable-threadsafe</p></li><li><p>mysql 3.23.49</p></li><li><p>postgreSQL 7.1.0</p></li><li><p>net-snmp 5.0.6</p></li><li><p>-lcrypto</p></li><li><p>libpcap 0.6.2</p></li><li><p>libpcre 3.9.10</p></li><li><p>libncurses 5.2</p></li><li><p>libesmtp 1.0.1</p></li><li><p>libreadline 4.3</p></li></ul></div><p>Delivered with upwatch are libstatgrab (0.7), xmbmon 2.03, and the State Threads Library (1,4).</p></div><div class="sect2" lang="en"><div class="titlepage"><div><h3 class="title"><a name="Build_requirements"></a>2.2.2. Build requirements</h3></div></div><p>You probably don't want to build upwatch yourself. Most likely you'll 
            grab the RPM packages and issue rpm -Uvh upwatch*rpm. Then skip to 
            <a href="#Configuration" title="Chapter 3. Configuration">Configuration</a>.
            </p><p> But on the other hand: you can build the software yourself. Apart from the normal GNU
                compilation tools, and the development versions of the above mentioned packages,
                you'll need the following on your system to build upwatch:</p><div class="itemizedlist"><ul type="disc"><li><p>autogen 5.3.6 (autogen.sourceforge.net)</p></li><li><p>if you also want to rebuild the manual: lynx 2.8.4, libxslt 1.0.15 and 
                docbook 1.48, including the entire toolchain: openjade, jadetex, tetex, 
                netpbm, perl-SGMLSpm.</p></li><li><p>RPM tools, if you want to build RPM's</p></li></ul></div><p>If you run RedHat, Debian or SuSE, don't forget to install the *-devel packages
                if there are any.</p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="Compiling_upwatch"></a>2.3. Compiling upwatch</h2></div></div><p>Just in case you really want to (or need to) compile upwatch yourself, it's
           pretty easy:
        </p><div class="literallayout"><p><br>
              $ tar xzvf upwatch-x.x.tar.gz<br>
              $ cd upwatch-x.x<br>
              $ ./configure<br>
              $ make<br>
           </p></div><p> Nothing to it... In case of problems, you're probably missing some library or
            header files, or they are in unexpected places. Look at the last parts
            of config.log.</p><p>You can optionally specify --enable-monitors, --enable-iptraf --enable-server 
         or --enable-all to configure. Default configure only builds the client, docs, and utils.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="Actual_Installation"></a>2.4. Actual Installation</h2></div></div><p> Before you install the software decide on the architecture. If you know in
            advance you'll have to monitor thousands of hosts, or the probes will exhaust your
            machine otherwise, you may have to split your installation across several machines.
            There may be more reasons to do that. Consult 'Scaling up' and 'How it all works' in the
            Programmers Guide.
        </p><p> For simplicity we assume you run everything on the same host. Type the following
           command as root:
        </p><div class="literallayout"><p><br>
          $ make install<br>
        </p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="php_pages"></a>2.5. PHP pages</h2></div></div><p> The PHP pages can just be copied to any directory. There is an include directory. Copy
          that a some location ouside the web root, and enter its location in the .htaccess file in the web root dir.
          Also enter the database details in config.php.
       </p></div><div class="sect1" lang="en"><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="Security_considerations"></a>2.6. Security considerations</h2></div></div><p> All upwatch directories are readable and writable by members of the group upwatch.
          Most all executables run as user upwatch.
          Some probes need root-access, most notable uw_ping, and they will be installed suid root.
          These probes drop root privileges wherever possible. Further you can assign each probe
          its own database user and grant that user access rights  to its own database tables.
          The probes itself don't write to the database, they only read from the
          <tt>pr_xxx_def</tt> tables.
       </p><p> The PHP web user should have SELECT, UPDATE, DELETE access to all tables.
       </p><p><b>uw_access</b>, and  <b>uw_accessbb</b> are
             the programs most vulnerable to crackers, as they wait
             for incoming connections on a TCP port (1985/1984). If possible, use <b>chroot</b> and
             firewall rules to limit connections to
             real probes only. Something similar holds for <b>mysql</b>. Most probes will want
             access, and passwords can be sniffed. For real security use ssh-tunnels.
       </p></div><div class="sect1" lang="en"><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="Database"></a>2.7. Database</h2></div></div><p>You actually need to create two databases, one for the probes to read from, and one 
        for the results to be written to. The first database should be called upwatch, the other
        one can be any name (we use netland). Create the databases as follows. (You DO have a root 
        password set for mysql don't you?)</p><div class="literallayout"><p><br>
           $ mysqladmin -u root --password=PASSWORD create upwatch<br>
           $ mysql -u root --password=PASSWORD upwatch &lt; upwatch-base.mysql<br>
           $ mysqladmin -u root --password=PASSWORD create netland<br>
           $ mysql -u root --password=PASSWORD netland &lt; upwatch-full.mysql<br>
        </p></div><p>Of course you need to assign users and GRANT them access. We start with 
           the probes. Mosts probes need read access to their definition table. 
           In many situations you can use just one user for that. Give that user access with:
        </p><div class="literallayout"><p><br>
           $ mysql -u root --PASSWORD=PASSWORD mysql<br>
           mysql&gt; GRANT SELECT ON upwatch.% TO probe@'192.168.1.23' IDENTIFIED BY 'PASSWD'<br>
        </p></div><p>Do this for every host that runs probes.</p><p>Next user is for the background processing and the php access:</p><div class="literallayout"><p><br>
           $ mysql -u root --PASSWORD=PASSWORD mysql<br>
           mysql&gt; GRANT SELECT, INSERT, UPDATE, DELETE ON `netland`.* TO 'upwatch'@'localhost' IDENTIFIED BY 'PASSWD'<br>
        </p></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><h2 class="title"><a name="Configuration"></a>Chapter 3. Configuration</h2></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt>3.1. <a href="#Probe_configuration">Probe configuration</a></dt><dt>3.2. <a href="#Database_configuration">Database configuration</a></dt></dl></div><div class="sect1" lang="en"><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="Probe_configuration"></a>3.1. Probe configuration</h2></div></div><p>
          Each probe first reads the general configuration file <tt>/etc/upwatch.conf</tt>
          and then its own configurationfile in <tt>/etc/upwatch.d</tt> if it exists.
          Normally some general things like the debug and logging level, and the database access
          are specified in the first file, and any probe-specific setting in the second file. You can also
          override settings from the generic file in the probe-specific file.
       </p><p> Each program has a manual page that documents options. Every long commandine option
          can also be entered in a configuration file.
       </p></div><div xmlns:ns1="" class="sect1" lang="en"><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="Database_configuration"></a>3.2. Database configuration</h2></div></div><ns1:p> First things first. Depending on the size of your installation you may
           run out of database or record space. It happened to me on the iptraf probe.
           I was measuring traffic for 4000 IP addresses and ran out of space after a month
           on the pr_iptraf_raw table - it hit the max_data_length limit. 
           I had to issue the following commands:
        </ns1:p><div class="literallayout"><p><br>
           $ mysql -u root --password=PASSWORD<br>
           mysql&gt; alter table pr_iptraf_raw max_rows = 1000000000;<br>
        </p></div><ns1:p>
           and this took almost two hours! So you better look at your own situation and
           adjust the settings MAX_ROWS and AVG_RECORD_SIZE accordingly for each table.
        </ns1:p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><h2 class="title"><a name="Administration"></a>Chapter 4. Administration</h2></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt>4.1. <a href="#logging">Logging</a></dt><dt>4.2. <a href="#managing_daemons">Managing daemons</a></dt><dt>4.3. <a href="#Queues">Queues</a></dt></dl></div><div class="sect1" lang="en"><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="logging"></a>4.1. Logging</h2></div></div><p> The upwatch package contains various ways of logging errors. The
         standard way is to its own logfile <tt>/var/log/upwatch/upwatch.log</tt>.
         Other ways are logging to stderr (probably not practical) and to the syslog. Tweak the 
         <tt>debug</tt> to increase the amount of logging. Setting the debug level
         higher than 2 should only be used for debugging serious problems, for example it
         causes daemons to stay always in the foreground. In debuglevel 0 only errors are logged,
         in debuglevel 1 some progress information is logged.
       </p><p> The website has its own logfile in <tt>log/error.log</tt></p></div><div class="sect1" lang="en"><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="managing_daemons"></a>4.2. Managing daemons</h2></div></div><p> In most Linux distributions you can start/stop daemons using the scripts
         in <tt>/etc/init.d</tt>. Don't forget: you will miss sample data in the database
         if a probe is not running. You can watch what a probe is running if you run 
         <b>ps ax</b>.
       </p></div><div class="sect1" lang="en"><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="Queues"></a>4.3. Queues</h2></div></div><p> Queues play an important part in upwatch. The queues are so-called <tt>maildir</tt>
       queues. This means that while the queuefile is written, it is written to a temporary directory, and when it's
       closed it is hardlinked to the actual queue directory. This way you can be absolutely sure that if you find
       a file in the queue, it is complete and nobody has the file open. Only one process reads from the
       queue and deletes the file when done. </p></div></div><div class="index"><div class="titlepage"><div><h2 class="title"><a name="id5366320"></a>Index</h2></div></div><div class="index"></div></div></div></body></html>
